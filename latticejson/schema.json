{
  "$id": "https://github.com/andreasfelix/latticejson/blob/master/latticejson/schema.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "JSON lattice file format",
  "description": "Defines the magnetic lattice format",
  "additionalProperties": false,
  "required": [
    "name",
    "lattice",
    "elements"
  ],
  "type": "object",
  "properties": {
    "name": {
      "type": "string",
      "description": "The name of the lattice"
    },
    "description": {
      "type": "string",
      "description": "A brief description of the lattice"
    },
    "lattice": {
      "type": "array",
      "items": {
        "type": "string"
      }
    },
    "sub_lattices": {
      "type": "object",
      "patternProperties": {
        "^.*$": {
          "$ref": "#/definitions/Lattice"
        }
      },
      "additionalProperties": false
    },
    "elements": {
      "type": "object",
      "patternProperties": {
        "^.*$": {
          "oneOf": [
            {
              "$ref": "#/definitions/Drift"
            },
            {
              "$ref": "#/definitions/Dipole"
            },
            {
              "$ref": "#/definitions/Quadrupole"
            },
            {
              "$ref": "#/definitions/Sextupole"
            },
            {
              "$ref": "#/definitions/Octupole"
            }
          ]
        }
      }
    }
  },
  "definitions": {
    "Lattice": {
      "type": "array",
      "items": {
        "type": "string"
      }
    },
    "Element": {
      "type": "object",
      "required": [
        "type",
        "length"
      ],
      "properties": {
        "type": {
          "type": "string",
          "description": "Type of the element."
        },
        "description": {
          "type": "string",
          "description": "Description of the element."
        },
        "length": {
          "type": "number",
          "minimum": 0,
          "description": "The length of the element."
        },
        "dx": {
          "type": "number",
          "description": "Horizontal misalignment"
        },
        "dy": {
          "type": "number",
          "description": "Vertical misalignment"
        },
        "ds": {
          "type": "number",
          "description": "Longitudinal misalignment"
        },
        "tilt": {
          "type": "number",
          "description": "Rotation about the longitudinal axis"
        }
      }
    },
    "Drift": {
      "allOf": [
        {
          "$ref": "#/definitions/Element"
        }
      ],
      "additionalProperties": false,
      "properties": {
        "type": {
          "const": "Drift"
        },
        "description": {},
        "length": {},
        "dx": {},
        "dy": {},
        "ds": {},
        "tilt": {}
      }
    },
    "Dipole": {
      "allOf": [
        {
          "$ref": "#/definitions/Element"
        }
      ],
      "additionalProperties": false,
      "properties": {
        "type": {
          "const": "Dipole"
        },
        "description": {},
        "length": {},
        "dx": {},
        "dy": {},
        "ds": {},
        "tilt": {},
        "angle": {
          "type": "number",
          "description": "Deflection angle"
        },
        "radius": {
          "type": "number",
          "description": "Radius of curvature"
        },
        "ps_value": {
          "type": "number",
          "description": "Power supply value."
        },
        "e1": {
          "type": "number"
        },
        "e2": {
          "type": "number"
        },
        "h1": {
          "type": "number"
        },
        "h2": {
          "type": "number"
        },
        "conversion_factor_ps_value": {
          "type": "number"
        }
      }
    },
    "Quadrupole": {
      "allOf": [
        {
          "$ref": "#/definitions/Element"
        }
      ],
      "additionalProperties": false,
      "properties": {
        "type": {
          "const": "Quadrupole"
        },
        "description": {},
        "length": {},
        "dx": {},
        "dy": {},
        "ds": {},
        "tilt": {},
        "k1": {
          "type": "number",
          "description": "Geometric quadrupole strength"
        },
        "ps_value": {
          "type": "number"
        },
        "conversion_factor_ps_value": {
          "type": "number"
        }
      }
    },
    "Sextupole": {
      "allOf": [
        {
          "$ref": "#/definitions/Element"
        }
      ],
      "additionalProperties": false,
      "properties": {
        "type": {
          "const": "Sextupole"
        },
        "description": {},
        "length": {},
        "dx": {},
        "dy": {},
        "ds": {},
        "tilt": {},
        "k2": {
          "type": "number",
          "description": "Geometric sextupole strength"
        },
        "ps_value": {
          "type": "number"
        },
        "conversion_factor_ps_value": {
          "type": "number"
        }
      }
    },
    "Octupole": {
      "allOf": [
        {
          "$ref": "#/definitions/Element"
        }
      ],
      "additionalProperties": false,
      "properties": {
        "type": {
          "const": "Octupole"
        },
        "description": {},
        "length": {},
        "dx": {},
        "dy": {},
        "ds": {},
        "tilt": {},
        "k3": {
          "type": "number",
          "description": "Geometric octupole strength"
        },
        "ps_value": {
          "type": "number"
        },
        "conversion_factor_ps_value": {
          "type": "number"
        }
      }
    },
    "Cavity": {
      "allOf": [
        {
          "$ref": "#/definitions/Element"
        }
      ],
      "additionalProperties": false,
      "required": [
        "voltage",
        "frequency"
      ],
      "properties": {
        "type": {
          "const": "Cavity"
        },
        "voltage": {
          "type": "number"
        },
        "frequency": {
          "type": "number"
        },
        "phase": {
          "type": "number"
        },
        "fiducial": {
          "type": "string"
        },
        "end1_focus": {
          "type": "number"
        },
        "end2_foucs": {
          "type": "number"
        }
      }
    }
  }
}